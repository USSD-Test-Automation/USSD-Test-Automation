{% extends "admin_base.html" %}

{% block title %}Test Cases{% endblock %}

{% block head_extra %}
{{ super() }}
<style>
    .btn-view {
        background-color: #4e73df;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 0.9em;
    }

    .btn-view:hover {
        background-color: #2e59d9;
    }

    table th,
    table td {
        vertical-align: middle !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-card shadow-sm p-4 mb-5 bg-white rounded">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="section-header"><i class="fas fa-vial"></i> Test Cases</h2>
        <a href="{{ url_for('create_testcase_form') }}" class="btn btn-warning shadow-sm">
            <i class="fas fa-plus-circle"></i> Create New Test Case
        </a>
    </div>

    {% include '_messages.html' %}

    <div class="row mb-3">
        <div class="col-12 col-md-6">
            <form method="GET" action="{{ url_for('test_cases') }}" class="form-inline">
                <div class="input-group w-100">
                    <input type="text" name="search" class="form-control" placeholder="Search test cases..."
                        value="{{ request.args.get('search', '') }}">
                    <div class="input-group-append">
                        <button class="btn btn-warning" type="submit">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table dashboard-table table-bordered table-hover">
            <thead>
                <tr>
                    <th>Code</th>
                    <th>Name</th>
                    <th>Module</th>
                    <th>Description</th>
                    <th>CreatedBy</th>
                    <th>CreatedAt</th>
                    <th>ModifiedBy</th>
                    <th>ModifiedAt</th>
                    <th>Steps</th>
                </tr>
            </thead>
            <tbody>
                {% if test_cases %}
                {% for tc in test_cases %}
                <tr>
                    <td>{{ tc.Code }}</td>
                    <td>{{ tc.Name }}</td>
                    <td>{{ tc.Module or 'N/A' }}</td>
                    <td>{{ tc.Description }}</td>
                    <td>{{ tc.CreatedByUsername or 'N/A' }}</td>
                    <td>{{ tc.CreatedAt.strftime('%Y-%m-%d %H:%M:%S') if tc.CreatedAt else 'N/A' }}</td>
                    <td>{{ tc.ModifiedByUsername or 'N/A' }}</td>
                    <td>{{ tc.ModifiedAt.strftime('%Y-%m-%d %H:%M:%S') if tc.ModifiedAt else 'N/A' }}</td>

                    <td>
                        <div class="d-flex justify-content-between gap-2">
                            <a href="{{ url_for('edit_test_case', testcase_id=tc.TestCaseID) }}"
                                class="btn btn-sm btn-warning" title="Edit Test Case">
                                <i class="fa fa-edit"></i>
                            </a>

                            <a href="{{ url_for('testcase_steps', testcase_id=tc.TestCaseID) }}"
                                class="btn btn-sm btn-info" title="View Steps">
                                <i class="fa fa-eye" aria-hidden="true"></i>
                            </a>

                            <button class="btn btn-sm btn-danger" data-toggle="modal"
                                data-target="#deleteModal{{ tc.TestCaseID }}">
                                <i class="fas fa-trash icon-delete"></i>
                            </button>
                        </div>
                    </td>

                </tr>

                <!-- Modal -->
                <div class="modal fade" id="deleteModal{{ tc.TestCaseID }}" tabindex="-1" role="dialog"
                    aria-labelledby="deleteModalLabel{{ tc.TestCaseID }}" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="deleteModalLabel{{ tc.TestCaseID }}">Confirm Delete</h5>
                                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                Are you sure you want to delete the test case "{{ tc.Name }}"?
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                                <a class="btn btn-danger"
                                    href="{{ url_for('delete_test_case', testcase_id=tc.TestCaseID) }}">Delete</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="9" class="text-center text-muted">üîç No test cases found.</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}